<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>ğŸ©µğŸ©· å¹¸ç¦æ—¶åˆ» ğŸ©·ğŸ©µ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",sans-serif;
  background:linear-gradient(135deg,#4ab7cc 0%,#f2b3c6 100%);
}

.wrapper{
  display:flex;
  height:100vh;
}

.sidebar{
  width:260px;
  background:#fff;
  padding:20px;
  overflow-y:auto;
  position:fixed;
  left:0;
  top:0;
  bottom:0;
  box-shadow:3px 0 15px rgba(0,0,0,.08);
}

.main{
  margin-left:260px;
  flex:1;
  overflow-y:auto;
  padding:40px;
}

.year{
  font-weight:bold;
  cursor:pointer;
  margin-top:10px;
}

.month{
  margin-left:15px;
  display:none;
  cursor:pointer;
  color:#666;
}

.day{
  margin-left:30px;
  font-size:14px;
  cursor:pointer;
  display:none;
}

.section{
  background:#fff;
  padding:30px;
  border-radius:20px;
  margin-bottom:40px;
  box-shadow:0 12px 35px rgba(0,0,0,.1);
}

.back{
  display:inline-block;
  margin-bottom:20px;
  text-decoration:none;
  color:#ff8fa3;
  font-weight:bold;
}

.back:hover{opacity:.7;}

@media(max-width:768px){
  .sidebar{position:relative;width:100%;height:auto;}
  .main{margin-left:0;}
  .wrapper{flex-direction:column;}
}
</style>
</head>

<body>

<div class="wrapper">

  <div class="sidebar">
    <h2>ğŸ©µ æ—¥æœŸç´¢å¼• ğŸ©·</h2>
    <div id="tree"></div>
  </div>

  <div class="main">
    <a href=" " class="back">â† è¿”å›é¦–é¡µ</a >
    <div id="posts"></div>

    <!-- ç•™è¨€ç³»ç»Ÿ -->
    <div id="cusdis_thread"
      data-host="https://cusdis.com"
      data-app-id="6bd954b7-e2b4-4206-a1c3-3072cecfc326"
      data-page-id="global-board"
      data-page-title="ç’€ç’¨ä¹‹è·¯">
    </div>
  </div>

</div>

<script src="https://cusdis.com/js/cusdis.es.js"></script>

<script>
const APP_ID = "6bd954b7-e2b4-4206-a1c3-3072cecfc326";

fetch(`https://cusdis.com/api/open/comments?appId=${APP_ID}&page=1`)
  .then(res=>res.json())
  .then(data=>{

    const comments = data.data;

    const tree = {};
    const postsDiv = document.getElementById("posts");
    const treeDiv = document.getElementById("tree");

    comments.forEach(c=>{
      const date = new Date(c.createdAt);
      const y = date.getFullYear();
      const m = String(date.getMonth()+1).padStart(2,"0");
      const d = String(date.getDate()).padStart(2,"0");

      if(!tree[y]) tree[y]={};
      if(!tree[y][m]) tree[y][m]={};
      if(!tree[y][m][d]) tree[y][m][d]=[];

      tree[y][m][d].push(c);
    });

    const sortedYears = Object.keys(tree).sort().reverse();

    sortedYears.forEach(y=>{
      const yearDiv=document.createElement("div");
      yearDiv.className="year";
      yearDiv.textContent=y;

      const monthWrap=document.createElement("div");

      yearDiv.onclick=()=>{
        monthWrap.style.display=
          monthWrap.style.display==="block"?"none":"block";
      };

      Object.keys(tree[y]).sort().reverse().forEach(m=>{
        const monthDiv=document.createElement("div");
        monthDiv.className="month";
        monthDiv.textContent=m;

        const dayWrap=document.createElement("div");

        monthDiv.onclick=(e)=>{
          e.stopPropagation();
          dayWrap.style.display=
            dayWrap.style.display==="block"?"none":"block";
        };

        Object.keys(tree[y][m]).sort().reverse().forEach(d=>{
          const dayDiv=document.createElement("div");
          dayDiv.className="day";
          dayDiv.textContent=d;

          dayDiv.onclick=(e)=>{
            e.stopPropagation();
            showPosts(y,m,d);
          };

          dayWrap.appendChild(dayDiv);
        });

        monthWrap.appendChild(monthDiv);
        monthWrap.appendChild(dayWrap);
      });

      treeDiv.appendChild(yearDiv);
      treeDiv.appendChild(monthWrap);
    });

    function showPosts(y,m,d){
      postsDiv.innerHTML="";
      tree[y][m][d].forEach(c=>{
        postsDiv.innerHTML+=`
          <div class="section">
            <h3>${y}-${m}-${d}</h3>
            <p>${c.content}</p >
            <small>${c.nickname}</small>
          </div>
        `;
      });
    }

    // é»˜è®¤æ˜¾ç¤ºæœ€æ–°ä¸€å¤©
    const y=sortedYears[0];
    const m=Object.keys(tree[y]).sort().reverse()[0];
    const d=Object.keys(tree[y][m]).sort().reverse()[0];
    showPosts(y,m,d);

  });
</script>

</body>
</html>
