<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ğŸ©µğŸ©· å¹¸ç¦æ—¶åˆ» ğŸ©·ğŸ©µ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;overflow:hidden;}

body{
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",sans-serif;
  background:linear-gradient(135deg,#4ab7cc 0%,#79cbd8 50%,#f2b3c6 100%);
}

/* ç²’å­ */
#particles{
  position:fixed;
  width:100%;
  height:100%;
  top:0;
  left:0;
  pointer-events:none;
  z-index:0;
}

.particle{
  position:absolute;
  border-radius:50%;
  opacity:.35;
  animation:float linear infinite;
}

@keyframes float{
  from{transform:translateY(100vh);}
  to{transform:translateY(-10vh);}
}

/* ä¸»å¸ƒå±€ */
.wrapper{
  position:relative;
  z-index:1;
  display:flex;
  height:100vh;
}

/* å·¦ä¾§ */
.sidebar{
  width:260px;
  padding:20px;
  overflow-y:auto;
}

.sidebar-title{
  color:#fff;
  font-weight:bold;
  margin-bottom:15px;
}

.tree-item{
  background:rgba(255,255,255,.85);
  border-radius:12px;
  padding:8px 12px;
  margin:6px 0;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
  transition:.2s;
}

.tree-item:hover{
  transform:translateX(4px);
}

.child{
  margin-left:18px;
  display:none;
}

/* å³ä¾§ */
.main{
  flex:1;
  padding:25px;
  display:flex;
  flex-direction:column;
}

.title{
  text-align:center;
  font-size:22px;
  font-weight:bold;
  color:#fff;
  margin-bottom:15px;
}

.comment-box{
  background:rgba(255,255,255,.9);
  border-radius:18px;
  padding:15px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
  margin-bottom:20px;
}

.comment-list{
  flex:1;
  background:rgba(255,255,255,.9);
  border-radius:18px;
  padding:20px;
  overflow-y:auto;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
}

.comment-card{
  background:#fff;
  border-radius:14px;
  padding:12px 16px;
  margin-bottom:15px;
  box-shadow:0 4px 12px rgba(0,0,0,.06);
}

.nickname{
  font-weight:bold;
  color:#4ab7cc;
  margin-bottom:6px;
}

.date{
  font-size:12px;
  color:#999;
  margin-bottom:6px;
}

.content{
  font-size:14px;
  line-height:1.6;
  color:#444;
}
</style>
</head>

<body>

<div id="particles"></div>

<div class="wrapper">

  <!-- å·¦ä¾§ -->
  <div class="sidebar">
    <div class="sidebar-title">ğŸ©µ æ—¥æœŸç´¢å¼• ğŸ©·</div>
    <div id="dateTree"></div>
  </div>

  <!-- å³ä¾§ -->
  <div class="main">

    <div class="title">å¹¸ç¦æ—¶åˆ»ï¼ˆç•™è¨€æ¿ï¼‰</div>

    <div class="comment-box">
      <div id="cusdis_thread"
        data-host="https://cusdis.com"
        data-app-id="6bd954b7-e2b4-4206-a1c3-3072cecfc326"
        data-page-id="happiness-page"
        data-page-title="å¹¸ç¦æ—¶åˆ»">
      </div>
    </div>

    <div class="comment-list" id="commentList">
      ç­‰å¾…ç•™è¨€åŠ è½½...
    </div>

  </div>
</div>

<script async defer src="https://cusdis.com/js/cusdis.es.js"></script>

<script>
/* ç²’å­ */
const particles=document.getElementById("particles");
for(let i=0;i<50;i++){
  const p=document.createElement("div");
  p.className="particle";
  const size=Math.random()*6+3;
  p.style.width=size+"px";
  p.style.height=size+"px";
  p.style.left=Math.random()*100+"%";
  p.style.background=Math.random()>.5?"#fff":"#ffd1ec";
  p.style.animationDuration=(Math.random()*15+10)+"s";
  particles.appendChild(p);
}

let allComments=[];
let currentFilter=null;

/* ç›‘å¬ Cusdis åŠ è½½å®Œæˆ */
window.addEventListener("message",function(event){
  if(event.data && event.data.from==="cusdis"){
    if(event.data.type==="comments:load"){
      allComments=event.data.data || [];
      buildTree();
      renderComments();
    }
  }
});

/* æ„å»ºæ—¥æœŸæ ‘ */
function buildTree(){
  const treeDiv=document.getElementById("dateTree");
  treeDiv.innerHTML="";
  const tree={};

  allComments.forEach(c=>{
    const d=new Date(c.created_at);
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,'0');
    const day=String(d.getDate()).padStart(2,'0');

    if(!tree[y]) tree[y]={};
    if(!tree[y][m]) tree[y][m]={};
    if(!tree[y][m][day]) tree[y][m][day]=true;
  });

  Object.keys(tree).sort().reverse().forEach(y=>{
    const year=document.createElement("div");
    year.className="tree-item";
    year.textContent=y+" â–¼";

    const monthWrap=document.createElement("div");
    monthWrap.className="child";

    year.onclick=()=>monthWrap.style.display=
      monthWrap.style.display==="block"?"none":"block";

    Object.keys(tree[y]).sort().reverse().forEach(m=>{
      const month=document.createElement("div");
      month.className="tree-item";
      month.textContent=m+" â–¼";

      const dayWrap=document.createElement("div");
      dayWrap.className="child";

      month.onclick=(e)=>{
        e.stopPropagation();
        dayWrap.style.display=
          dayWrap.style.display==="block"?"none":"block";
      };

      Object.keys(tree[y][m]).sort().reverse().forEach(d=>{
        const day=document.createElement("div");
        day.className="tree-item";
        day.textContent=d;

        day.onclick=(e)=>{
          e.stopPropagation();
          currentFilter=`${y}-${m}-${d}`;
          renderComments();
        };

        dayWrap.appendChild(day);
      });

      monthWrap.appendChild(month);
      monthWrap.appendChild(dayWrap);
    });

    treeDiv.appendChild(year);
    treeDiv.appendChild(monthWrap);
  });
}

/* æ¸²æŸ“ç•™è¨€ */
function renderComments(){
  const list=document.getElementById("commentList");
  list.innerHTML="";

  let filtered=allComments;

  if(currentFilter){
    filtered=allComments.filter(c=>{
      const d=new Date(c.created_at);
      return d.toISOString().split("T")[0]===currentFilter;
    });
  }

  if(filtered.length===0){
    list.innerHTML="è¿™ä¸€å¤©è¿˜æ²¡æœ‰ç•™è¨€ ğŸŒ¸";
    return;
  }

  filtered.forEach(c=>{
    const d=new Date(c.created_at);
    const card=document.createElement("div");
    card.className="comment-card";
    card.innerHTML=`
      <div class="nickname">${c.nickname}</div>
      <div class="date">${d.toLocaleString()}</div>
      <div class="content">${c.content}</div>
    `;
    list.appendChild(card);
  });
}

/* 30ç§’è‡ªåŠ¨åˆ·æ–° */
setInterval(()=>{
  if(window.CUSDIS){
    window.CUSDIS.reload();
  }
},30000);

</script>

</body>
</html>
