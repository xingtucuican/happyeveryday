<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>ğŸ©µğŸ©· å¹¸ç¦æ—¶åˆ» ğŸ©·ğŸ©µ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",sans-serif;
  background:linear-gradient(135deg,#4ab7cc 0%,#f2b3c6 100%);
}

/* ===== å¸ƒå±€ ===== */
.wrapper{
  display:flex;
  height:100vh;
}

/* ===== å·¦ä¾§ ===== */
.sidebar{
  width:260px;
  background:#fff;
  padding:20px;
  overflow-y:auto;
  box-shadow:3px 0 15px rgba(0,0,0,.08);
  position:fixed;
  left:0;
  top:0;
  bottom:0;
}

.sidebar h2{
  margin:0 0 20px;
  font-size:18px;
}

.year{font-weight:bold;cursor:pointer;margin-top:12px;}
.month{margin-left:15px;display:none;}
.month-title{cursor:pointer;margin-top:6px;color:#666;}
.day{margin-left:20px;display:none;}
.day-item{cursor:pointer;font-size:14px;margin:4px 0;}
.day-item:hover{color:#f2b3c6;}

/* ===== å³ä¾§ ===== */
.main{
  margin-left:260px;
  flex:1;
  overflow-y:auto;
  padding:40px;
}

.section{
  background:#fff;
  padding:30px;
  border-radius:20px;
  margin-bottom:40px;
  box-shadow:0 12px 35px rgba(0,0,0,.1);
}

.section h3{text-align:center;margin-top:0;}

.back{
  display:inline-block;
  margin-bottom:20px;
  text-decoration:none;
  color:#ff8fa3;
  font-weight:bold;
}

.back:hover{opacity:.7;}

@media(max-width:768px){
  .sidebar{position:relative;width:100%;height:auto;}
  .main{margin-left:0;}
  .wrapper{flex-direction:column;}
}
</style>
</head>

<body>

<div class="wrapper">

  <!-- å·¦ä¾§ -->
  <div class="sidebar">
    <h2>ğŸ©µ æ—¥æœŸç´¢å¼• ğŸ©·</h2>
    <div id="tree"></div>
  </div>

  <!-- å³ä¾§ -->
  <div class="main">

    <a href=" " class="back" id="backBtn">â† è¿”å›é¦–é¡µ</a >

    <!-- ç•™è¨€æ¿ -->
    <div id="default-board" class="section">
      <h3>ç•™è¨€æ¿</h3>
      <div
        id="cusdis_thread"
        data-host="https://cusdis.com"
        data-app-id="6bd954b7-e2b4-4206-a1c3-3072cecfc326"
        data-page-id="happiness"
        data-page-title="å¹¸ç¦æ—¶åˆ»">
      </div>
    </div>

    <div id="posts"></div>

  </div>

</div>

<!-- å…ˆåŠ è½½ Cusdis -->
<script async defer src="https://cusdis.com/js/cusdis.es.js"></script>

<script>
// å¼ºåˆ¶ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆååˆ·æ–° Cusdis
window.addEventListener("load", function(){
  if(window.CUSDIS){
    window.CUSDIS.refresh();
  }
});

fetch("./diary.json")
.then(res=>res.json())
.then(list=>{

  const treeDiv=document.getElementById("tree");
  const postsDiv=document.getElementById("posts");
  const defaultBoard=document.getElementById("default-board");

  const tree={};

  list.forEach(item=>{
    if(!tree[item.year]) tree[item.year]={};
    if(!tree[item.year][item.month]) tree[item.year][item.month]=[];
    tree[item.year][item.month].push(item);
  });

  Object.keys(tree).sort().reverse().forEach(y=>{

    const yearDiv=document.createElement("div");
    yearDiv.className="year";
    yearDiv.textContent="ğŸ“‚ "+y;

    const monthWrap=document.createElement("div");
    monthWrap.className="month";

    yearDiv.onclick=()=>{
      monthWrap.style.display=
        monthWrap.style.display==="block"?"none":"block";
    };

    Object.keys(tree[y]).sort().reverse().forEach(m=>{

      const monthTitle=document.createElement("div");
      monthTitle.className="month-title";
      monthTitle.textContent="ğŸ“ "+m;

      const dayWrap=document.createElement("div");
      dayWrap.className="day";

      monthTitle.onclick=(e)=>{
        e.stopPropagation();
        dayWrap.style.display=
          dayWrap.style.display==="block"?"none":"block";
      };

      tree[y][m]
      .sort((a,b)=>b.day-a.day)
      .forEach(item=>{

        const dayDiv=document.createElement("div");
        dayDiv.className="day-item";
        dayDiv.textContent=item.day;

        dayDiv.onclick=(e)=>{
          e.stopPropagation();
          defaultBoard.style.display="none";

          fetch("./"+item.file)
          .then(res=>res.text())
          .then(html=>{
            postsDiv.innerHTML=`
              <div class="section">
                <h3>${item.year}-${item.month}-${item.day}</h3>
                ${html}
              </div>
            `;
          });
        };

        dayWrap.appendChild(dayDiv);
      });

      monthWrap.appendChild(monthTitle);
      monthWrap.appendChild(dayWrap);
    });

    treeDiv.appendChild(yearDiv);
    treeDiv.appendChild(monthWrap);
  });

  // è¿”å›é¦–é¡µ
  document.getElementById("backBtn").onclick=function(e){
    e.preventDefault();
    postsDiv.innerHTML="";
    defaultBoard.style.display="block";

    if(window.CUSDIS){
      window.CUSDIS.refresh();
    }
  };

});
</script>

</body>
</html>
